---
title: 移动端横屏适配
date: 2019-05-31 14:40:10
tags: Other
categories:
- Other
---
我们在做移动端页面的时候，绝大部分页面都是在竖屏展示。而随着用户需求的更加，开始出现了需要横屏展示的页面。那么，作为前端开发人员，如何去做横屏适配呢？本场 Chat 就来说说移动端中的横屏适配：

1. 横屏适配需求
2. 横屏适配两种实现方式
3. 横屏中使用 dom 元素
4. 横屏中使用 canvas 以及 canvas 框架
5. 横屏适配小贴士

本 Chat 主要面向于前端开发者以及从事移动端相关开发的人员。

<!-- more -->
对于大部分的 Html5 应用来说，我们可以按照屏幕的方向来分为：横屏和竖屏。在日常的开发需求中，以竖屏展示的应用为主，横屏展示的形式比较少。那么这篇文章，主要就来探讨一下，怎么样去做横屏适配。

## 横屏适配需求
在开始讲横屏适配做法之前，我们先来分析一下横屏适配的需求情况。目前 Html5 应用以及各大小程序中，横屏形式的需求不多，主要原因有下面几个：

1. 日常使用手机是竖屏形式，横屏展示的应用不方便使用
2. 竖屏的资源样式，放在横屏里面很多都不适用，特别是设计方面
3. 资料比较少，遇到问题难以解决

针对上面几个问题，我总结了下面几类使用到横屏的需求：
> - 视频类 H5
> - 游戏类 H5
> - AR、 地图和重力感应等特殊需求的 H5

除了这三类以外，其他的需求都很少会需要横屏适配，所以只需要针对这几类的 H5 做好适配就基本上满足需求了。

## 横屏适配两种实现方式
日常开发中，横屏适配主要有两种实现方式：要求用户锁屏和不要求用户锁屏

### 要求用户锁屏
由于智能手机用户大部分都会开启锁屏的功能，所以大部分的横屏应用其实只需要做竖屏，只是看起来是横屏而已。

这种方法，开发起来跟竖屏差别不大，只是需要对元素做一些旋转，以及当用于没有锁屏的时候提示锁屏。

由于开发起来跟竖屏一样，所以开发难度不大，并且不需要关注兼容性问题，这方法是很多应用的首选。

### 不要求用户锁屏
而如果应用需要做到 “完美横屏” ，也就是无论用户是否锁屏也能正常展示，这样就要求兼容横屏以及竖屏两种形式。

这种方法，开发难度较大，对程序的兼容性要求极高，大部分应用都不会采用。不过如果需求确实需要或者你是一个追求完美的前端工程师，能够掌握 “完美横屏” 确实能加分不少。

> 下面就是具体是实现方式，我把横屏适配分成 dom 和 canvas 两类，原因是 dom 和 canvas 实现的方式不一样，难以程度也有所差别

## 横屏中使用 dom 元素
当我们使用 dom 元素来制作 Html5 应用的时候，在页面上展现的是文字、图片以及视频。

### 要求用户锁屏
那么，如果是要求用户锁屏的话，我们的做法其实很简单：

1. 首先横屏的时候，把遮罩层展示出来
```
@media screen and (orientation: landscape) {
  .cove {
    display: block;
  }
}
```
![enter image description here](https://images.gitbook.cn/02311110-8c16-11e9-a7e7-eb4c90aeca8f)

2. 把 dom 元素用 transform 选择 90 deg
```
transform:rotate(90deg);
-ms-transform:rotate(90deg); 	/* IE 9 */
-moz-transform:rotate(90deg); 	/* Firefox */
-webkit-transform:rotate(90deg); /* Safari 和 Chrome */
-o-transform:rotate(90deg); 	/* Opera */
```

> 这里有两点要注意：
> - 尽量把图片和视频做成横屏的形式，减少旋转的操作
> - 不要使用会在页面生成 dom 元素的插件，因为没有办法控制其旋转

做了这两步兼容之后，一个横屏的应用就可以实现了，剩下的只是如何去调整细微的布局。

### 不要求用户锁屏
如果需要实现用户是否锁屏也能正常展示的话，问题就会变得很复杂了：

#### 主要使用下面两个方法来实现不锁屏时候的横屏适配

- 使用 css 的媒体查询，在竖屏以及横屏的时候，分别写下对应的样式
```
@media screen and (orientation: portrait) { ... }
@media screen and (orientation: landscape) { ... }
```

- 使用 javascript 判断横屏竖屏
```
window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", function() {
  if (window.orientation === 180 || window.orientation === 0) {
    ...
  }
  if (window.orientation === 90 || window.orientation === -90 ){
    ...
  } 
}, false);
```

那么该如何去使用这两个方法呢？

1. 首先，对需求进行详细分析，需要关注几个横屏适配的要点：

> - 判断哪些部分需要横屏，哪些部分不需要
正常情况下，横屏的页面所有元素都是横屏展示，不过也有例外，需要区分好，把需要横屏的包在一个 div 里面

> - 是否有页面的滚动
有页面滚动的话，在竖屏和横屏切换的时候，需要改变滚动方向

> - 是否有改变元素位置的动画效果（旋转，平移等等）
动画效果需要注意，竖屏和横屏切换后，动画效果需要调整

2. 选用合适的缩放模式

确定好应用的需求之后，需要根据游戏的实际场景需求，选择一种缩放模式。什么是缩放模式呢，可以参考 css 中的 [object-fit](https://developer.mozilla.org/zh-CN/docs/Web/CSS/object-fit)。

> **要选择缩放模式的原因：**
> 一是因为不同型号的手机，尺寸都不一样（这点我们在做竖屏页面开发的时候也需要兼容）
> 二是我们开发过程中，需要考虑页面在不同 App 和浏览器上面的展示效果（例如，某款手机的尺寸是 360 * 640。可是在微信中，竖屏页面高度需要减去顶部的标题栏，那可能就只剩 360 * 585；那横屏之后，宽高就会变成 305 * 640）

于是，我们需要先定好一种缩放模式，先解决了页面尺寸的兼容。那么该如何去选择缩放模式呢？举个例子，假设下图是我们需要的应用区域（为了展示效果明显，我选择了比较窄的图片进行展示）
![enter image description here](https://images.gitbook.cn/798832a0-8c1d-11e9-9e3d-f110b7b3c3f0)

下图则是屏幕区域
![enter image description here](https://images.gitbook.cn/7b693230-8c1e-11e9-9e3d-f110b7b3c3f0)

- fill 模式（全屏模式）
![enter image description here](https://images.gitbook.cn/2d674180-8c1e-11e9-a043-2ffb50ea2294)
> 这种模式，会把游戏区域铺满屏幕区域，游戏区域的内容会拉伸。
> 
> 优点：该模式页面不会出现空白；
> 缺点：页面比例拉伸，展示效果比较差
>
> **对于一些简单的或者图片不多的需求，可以使用**

- contain 模式（包含模式）
![enter image description here](https://images.gitbook.cn/70ba6790-8c1f-11e9-9aa2-f543c13cf434)
> 这种模式，会根据游戏区域的尺寸比例，自动缩放，然后在屏幕区域中居中展示。
> 
> 优点：游戏区域比例能够维持，计算方便；
> 缺点：屏幕会出现空白，需要指定游戏区域的尺寸
>
> **这种模式由于方便开发，是一些复杂的应用常用的模式**

- 固定宽度模式（横屏的宽度，竖屏的高度）
![enter image description here](https://images.gitbook.cn/e4907cc0-8da7-11e9-bd8d-01a64709964f)
> 这种模式，把游戏区域按比例方法或者缩小，直到在横屏的时候宽度跟屏幕宽度一样（或者竖屏的时候高度跟屏幕高度一样）。
> 
> 优点：页面不会出现空白，游戏区域比例能够维持；
> 缺点：对于横屏游戏，游戏区域底部有所缺失
>
> **这种模式游戏区域缺失会比较严重，特殊情况可以使用，一般会使用下面固定高度的模式**

- 固定高度模式（横屏的高度，竖屏的宽度）
![enter image description here](https://images.gitbook.cn/b1b71a60-8da8-11e9-9bce-b980593f0a9b)
> 这种模式，把游戏区域按比例方法或者缩小，直到在横屏的时候高度跟屏幕高度一样（或者竖屏的时候宽度跟屏幕宽度一样）。
> 
> 优点：页面不会出现空白，游戏区域比例能够维持，并且游戏区域缺失部分在右侧，相对较少；
> 缺点：游戏区域右侧有所缺失，需要注意主体部分避开游戏区域右侧
>
> **这种模式能够满屏展示，不留空白，是横屏适配中常用的形式。虽然游戏区域有所缺失，但是只要稍微控制一下设计稿，不要把主体部分放在右侧即可。**

选择好缩放模式之后，通过 css 来设置这几种模式，难度都不大。设置好之后，在项目开发阶段：

- 竖屏的情况，按照上面锁屏的方法做，把元素选择 90 度展示

- 横屏的情况，不需要把元素旋转 90 度，相当于竖屏时候的做法


## 横屏中使用 canvas 以及 canvas 框架
说完 dom 中的横屏，来说说 canvas 里面的横屏适配。之所以要把 canvas 单独拿出来，是因为 canvas 我们用来制作动画和游戏等一些业务逻辑相对复杂的应用。而且 canvas 中，没有 css 的 @media screen and (orientation: portrait) 方法，如果通过 js 代码来写，工作量就相当大了。

那么对于 canvas 来说，一般会怎么做横屏适配呢？

### 方法一：两套 canvas 实现
简单地说，就是页面上有两个 canvas，一个负责横屏，一个负责竖屏，并且数据是相通的。这种方法确实能够很好地解决问题，但是局限性比较大，不适合业务逻辑相对复杂的 canvas 应用。

### 方法二：缩放模式 + canvas 重绘
